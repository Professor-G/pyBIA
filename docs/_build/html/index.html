
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Welcome to MicroLIA’s documentation! &#8212; MicroLIA 1.61 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="welcome-to-microlia-s-documentation">
<h1>Welcome to MicroLIA’s documentation!<a class="headerlink" href="#welcome-to-microlia-s-documentation" title="Permalink to this headline">¶</a></h1>
<p>MicroLIA is an open-source program for microlensing detection in wide-field surveys. This engine uses the machine learning RF model using a variety of lightcurve statistics, therefore a training set with survey parameters must be created before MicroLIA can begin its query. See example below.</p>
</section>
<section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>The current stable version can be installed via pip:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install MicroLIA
</pre></div>
</div>
</section>
<section id="example-ogle-iv">
<h1>Example: OGLE IV<a class="headerlink" href="#example-ogle-iv" title="Permalink to this headline">¶</a></h1>
<p>The lightcurves for 219 OGLE IV microlensing events can be downloaded here:</p>
<p>Each file contains three columns: time, mag, magerr</p>
<p>We will train MicroLIA for OGLE IV microlensing detection, and record how many of these 219 events we successfully recover.</p>
</section>
<section id="ogle-iv-training-set">
<h1>OGLE IV: Training Set<a class="headerlink" href="#ogle-iv-training-set" title="Permalink to this headline">¶</a></h1>
<p>Adaptive cadence is important as this allows MicroLIA to detect microlensing events even if the survey footprint is sparse. In this example we need to train MicroLIA using OGLE IV cadence, which we can take to be the timestamps of these 219 lightcurves. We will append the time array of each lightcurve to a list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/data&#39;</span><span class="p">)</span>

<span class="n">timestamps</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
  <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">name</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
</pre></div>
</div>
<p>This time list will be used to simulate our training data, as each time an event is simulated a random timestamp from the list which will be chosen. We can now create our training data using the training_set module – in this example we will set the min_mag of the survey to be 15, and the max_mag to be 20. We will also set n_class=500, this is the size of our training classes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MicroLIA</span> <span class="kn">import</span> <span class="n">training_set</span>

<span class="n">training_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">min_mag</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">max_mag</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">n_class</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
<p>There are a number of other parameters we can control when creating the training set, including exposure time and zeropoint of the survey telescope. Setting these parameters carefully will ensure that our training set matches what will be observed.</p>
<p>To be more accurate we will set these optional parameters, and even include a noise model using the rms and median mag of our OGLE IV data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MicroLIA</span> <span class="kn">import</span> <span class="n">training_set</span>
<span class="kn">from</span> <span class="nn">MicroLIA</span> <span class="kn">import</span> <span class="n">noise_models</span>

<span class="n">rms_mag</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">median_mag</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
   <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">i</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
   <span class="n">rms</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="mi">84</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
   <span class="n">rms_mag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rms</span><span class="p">)</span>
   <span class="n">median_mag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">mag</span><span class="p">))</span>

<span class="n">ogle_noise</span> <span class="o">=</span> <span class="n">noise_models</span><span class="o">.</span><span class="n">create_noise</span><span class="p">(</span><span class="n">median</span><span class="p">,</span> <span class="n">rms</span><span class="p">)</span>

<span class="n">training_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">min_mag</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">median_mag</span><span class="p">),</span>
   <span class="n">max_mag</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">median_mag</span><span class="p">),</span> <span class="n">noise</span><span class="o">=</span><span class="n">ogle_noise</span><span class="p">,</span> <span class="n">zp</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
   <span class="n">exptime</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">n_class</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
<p>This will simulate the lightcurves for our training set, all of which will be saved in the ‘lightcurves.fits’ file, organized by ID. The other two files ‘pca_features.txt’, and ‘all_features.txt’ include the data that will be used to train our machine learning model. To learn about these files click here.</p>
</section>
<section id="ogle-iv-microlensing-classification">
<h1>OGLE IV: Microlensing Classification<a class="headerlink" href="#ogle-iv-microlensing-classification" title="Permalink to this headline">¶</a></h1>
<p>We will create our Random Forest machine learning model using the statistical features only:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MicroLIA</span> <span class="kn">import</span> <span class="n">models</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">create_models</span><span class="p">(</span><span class="s1">&#39;all_features.txt&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the model saved we can begin classifying any lightcurve! Let’s load the first OGLE IV microlensing lightcurve and check what the prediction is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">MicroLIA</span> <span class="kn">import</span> <span class="n">microlensing_classifier</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">time</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>

<span class="n">prediction</span> <span class="o">=</span> <span class="n">microlensing_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
</pre></div>
</div>
<p>The prediction output is the probability prediction of each class. Finally, let’s load all 219 lightcurves and check the overall prediction accuracy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
   <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
   <span class="n">time</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>

   <span class="n">prediction</span> <span class="o">=</span> <span class="n">microlensing_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
   <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;total accuracy &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="s1">&#39;ML&#39;</span><span class="p">))))</span>
</pre></div>
</div>
</section>
<section id="ogle-iv-from-start-to-finish">
<h1>OGLE IV: From start to finish<a class="headerlink" href="#ogle-iv-from-start-to-finish" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">MicroLIA</span> <span class="kn">import</span> <span class="n">training_set</span><span class="p">,</span> <span class="n">microlensing_classifier</span>
<span class="kn">from</span> <span class="nn">MicroLIA</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">noise_models</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/data&#39;</span><span class="p">)</span> <span class="c1">#219</span>

<span class="n">timestamps</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#</span>
<span class="n">rms_mag</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">median_mag</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
   <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">name</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
   <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">name</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>

   <span class="n">rms</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="mi">84</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
   <span class="n">timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
   <span class="n">median_mag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">mag</span><span class="p">))</span>
   <span class="n">rms_mag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rms</span><span class="p">)</span>

<span class="n">ogle_noise</span> <span class="o">=</span> <span class="n">noise_models</span><span class="o">.</span><span class="n">create_noise</span><span class="p">(</span><span class="n">median_mag</span><span class="p">,</span> <span class="n">rms_mag</span><span class="p">)</span>

<span class="n">training_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">min_mag</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">median_mag</span><span class="p">),</span> <span class="n">max_mag</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">median_mag</span><span class="p">),</span> <span class="n">noise</span><span class="o">=</span><span class="n">ogle_noise</span><span class="p">,</span> <span class="n">zp</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">exptime</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">n_class</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">create_models</span><span class="p">(</span><span class="s1">&#39;all_features.txt&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;rf&#39;</span><span class="p">)</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
   <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
   <span class="n">time</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>

   <span class="n">prediction</span> <span class="o">=</span> <span class="n">microlensing_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
   <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;total accuracy &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="s1">&#39;ML&#39;</span><span class="p">))))</span>
</pre></div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">MicroLIA</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Daniel Godines.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>